var iws=iws||{version:"1.0.0"};(function(){iws.loader=function(){this.initialize.apply(this,arguments)};iws.loader.prototype={imgCanvas:null,dataPtr:null,dataHeap:null,iwsImg:null,isValid:false,pageCount:0,src:"",initialize:function(a){this.imgCanvas=document.createElement("canvas");this.imgCanvas.getContext("2d").imageSmoothingEnabled=true;this.imgCanvas.width=0;this.imgCanvas.height=0;this.dataPtr=IWSImageLib._malloc(a.byteLength);this.dataHeap=new Uint8Array(IWSImageLib.HEAPU8.buffer,this.dataPtr,a.byteLength);this.dataHeap.set(new Uint8Array(a));this.iwsImg=new IWSImageLib.CIWSImageWeb();this.pageCount=this.iwsImg.GetPageCount(this.dataHeap.byteOffset,this.dataHeap.byteLength);if(this.pageCount>0){this.isValid=true}},getCount:function(){return this.pageCount},_dataToSrc:function(a,b,c){this.imgCanvas.width=a;this.imgCanvas.height=b;var d=this.imgCanvas.getContext("2d").createImageData(a,b);d.data.set(c);this.imgCanvas.getContext("2d").putImageData(d,0,0);this.src=this.imgCanvas.toDataURL()},getSrc:function(a,b){this.getPage(a,this._dataToSrc);b&&b(this.src);return this.src},getPage:function(h,k){var b=this.iwsImg.DecodeInfomation(this.dataHeap.byteOffset,this.dataHeap.byteLength,h);if(b===1){var c={width:this.iwsImg.GetImageWidth(),height:this.iwsImg.GetImageHeight(),bpp:this.iwsImg.GetBitperpixel(),xResolution:this.iwsImg.GetXresolution(),yResolution:this.iwsImg.GetYresolution()};var d=null;var a=null;var e=(c.width*c.height)*4;var i=0;if(c.bpp<=8){var g=c.width*c.height;var j=IWSImageLib._malloc(g);var f=new Uint8ClampedArray(IWSImageLib.HEAPU8.buffer,j,g);i=this.iwsImg.DecodeImage(this.dataHeap.byteOffset,this.dataHeap.byteLength,h,f.byteOffset);if(i==1){a=IWSImageLib._malloc(e);d=new Uint8ClampedArray(IWSImageLib.HEAPU8.buffer,a,e);this.iwsImg.SetRowData(d.byteOffset)}IWSImageLib._free(j);j=null;f=null}else{a=IWSImageLib._malloc(e);d=new Uint8ClampedArray(IWSImageLib.HEAPU8.buffer,a,e);i=this.iwsImg.DecodeImage(this.dataHeap.byteOffset,this.dataHeap.byteLength,h,d.byteOffset)}k&&k.call(this,c.width,c.height,d);IWSImageLib._free(d.byteOffset);return true}return false},dispose:function(){this.dataPtr&&IWSImageLib._free(this.dataPtr);this.dataPtr=null;this.dataHeap=null;this.iwsImg&&this.iwsImg.DeleteImageEx();this.iwsImg=null},}})();